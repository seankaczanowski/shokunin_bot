{"version":3,"file":"5521.511b0ee716bdea612870.js?v=511b0ee716bdea612870","mappings":"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","sources":["webpack://@jupyterlab/application-top/./node_modules/@jupyter/ydoc/lib/utils.js","webpack://@jupyterlab/application-top/./node_modules/y-protocols/awareness.js","webpack://@jupyterlab/application-top/./node_modules/@jupyter/ydoc/lib/ydocument.js","webpack://@jupyterlab/application-top/./node_modules/@jupyter/ydoc/lib/yfile.js","webpack://@jupyterlab/application-top/./node_modules/@jupyter/ydoc/lib/ycell.js","webpack://@jupyterlab/application-top/./node_modules/@jupyter/ydoc/lib/ynotebook.js","webpack://@jupyterlab/application-top/./node_modules/lib0/array.js","webpack://@jupyterlab/application-top/./node_modules/lib0/function.js","webpack://@jupyterlab/application-top/./node_modules/lib0/map.js","webpack://@jupyterlab/application-top/./node_modules/lib0/math.js","webpack://@jupyterlab/application-top/./node_modules/lib0/object.js","webpack://@jupyterlab/application-top/./node_modules/lib0/observable.js","webpack://@jupyterlab/application-top/./node_modules/lib0/set.js","webpack://@jupyterlab/application-top/./node_modules/lib0/time.js"],"sourcesContent":["/* -----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\nexport function convertYMapEventToMapChange(event) {\n    let changes = new Map();\n    event.changes.keys.forEach((event, key) => {\n        changes.set(key, {\n            action: event.action,\n            oldValue: event.oldValue,\n            newValue: this.ymeta.get(key)\n        });\n    });\n    return changes;\n}\n/**\n * Creates a mutual exclude function with the following property:\n *\n * ```js\n * const mutex = createMutex()\n * mutex(() => {\n *   // This function is immediately executed\n *   mutex(() => {\n *     // This function is not executed, as the mutex is already active.\n *   })\n * })\n * ```\n */\nexport const createMutex = () => {\n    let token = true;\n    return (f) => {\n        if (token) {\n            token = false;\n            try {\n                f();\n            }\n            finally {\n                token = true;\n            }\n        }\n    };\n};\n//# sourceMappingURL=utils.js.map","/**\n * @module awareness-protocol\n */\n\nimport * as encoding from 'lib0/encoding'\nimport * as decoding from 'lib0/decoding'\nimport * as time from 'lib0/time'\nimport * as math from 'lib0/math'\nimport { Observable } from 'lib0/observable'\nimport * as f from 'lib0/function'\nimport * as Y from 'yjs' // eslint-disable-line\n\nexport const outdatedTimeout = 30000\n\n/**\n * @typedef {Object} MetaClientState\n * @property {number} MetaClientState.clock\n * @property {number} MetaClientState.lastUpdated unix timestamp\n */\n\n/**\n * The Awareness class implements a simple shared state protocol that can be used for non-persistent data like awareness information\n * (cursor, username, status, ..). Each client can update its own local state and listen to state changes of\n * remote clients. Every client may set a state of a remote peer to `null` to mark the client as offline.\n *\n * Each client is identified by a unique client id (something we borrow from `doc.clientID`). A client can override\n * its own state by propagating a message with an increasing timestamp (`clock`). If such a message is received, it is\n * applied if the known state of that client is older than the new state (`clock < newClock`). If a client thinks that\n * a remote client is offline, it may propagate a message with\n * `{ clock: currentClientClock, state: null, client: remoteClient }`. If such a\n * message is received, and the known clock of that client equals the received clock, it will override the state with `null`.\n *\n * Before a client disconnects, it should propagate a `null` state with an updated clock.\n *\n * Awareness states must be updated every 30 seconds. Otherwise the Awareness instance will delete the client state.\n *\n * @extends {Observable<string>}\n */\nexport class Awareness extends Observable {\n  /**\n   * @param {Y.Doc} doc\n   */\n  constructor (doc) {\n    super()\n    this.doc = doc\n    /**\n     * @type {number}\n     */\n    this.clientID = doc.clientID\n    /**\n     * Maps from client id to client state\n     * @type {Map<number, Object<string, any>>}\n     */\n    this.states = new Map()\n    /**\n     * @type {Map<number, MetaClientState>}\n     */\n    this.meta = new Map()\n    this._checkInterval = /** @type {any} */ (setInterval(() => {\n      const now = time.getUnixTime()\n      if (this.getLocalState() !== null && (outdatedTimeout / 2 <= now - /** @type {{lastUpdated:number}} */ (this.meta.get(this.clientID)).lastUpdated)) {\n        // renew local clock\n        this.setLocalState(this.getLocalState())\n      }\n      /**\n       * @type {Array<number>}\n       */\n      const remove = []\n      this.meta.forEach((meta, clientid) => {\n        if (clientid !== this.clientID && outdatedTimeout <= now - meta.lastUpdated && this.states.has(clientid)) {\n          remove.push(clientid)\n        }\n      })\n      if (remove.length > 0) {\n        removeAwarenessStates(this, remove, 'timeout')\n      }\n    }, math.floor(outdatedTimeout / 10)))\n    doc.on('destroy', () => {\n      this.destroy()\n    })\n    this.setLocalState({})\n  }\n\n  destroy () {\n    this.emit('destroy', [this])\n    this.setLocalState(null)\n    super.destroy()\n    clearInterval(this._checkInterval)\n  }\n\n  /**\n   * @return {Object<string,any>|null}\n   */\n  getLocalState () {\n    return this.states.get(this.clientID) || null\n  }\n\n  /**\n   * @param {Object<string,any>|null} state\n   */\n  setLocalState (state) {\n    const clientID = this.clientID\n    const currLocalMeta = this.meta.get(clientID)\n    const clock = currLocalMeta === undefined ? 0 : currLocalMeta.clock + 1\n    const prevState = this.states.get(clientID)\n    if (state === null) {\n      this.states.delete(clientID)\n    } else {\n      this.states.set(clientID, state)\n    }\n    this.meta.set(clientID, {\n      clock,\n      lastUpdated: time.getUnixTime()\n    })\n    const added = []\n    const updated = []\n    const filteredUpdated = []\n    const removed = []\n    if (state === null) {\n      removed.push(clientID)\n    } else if (prevState == null) {\n      if (state != null) {\n        added.push(clientID)\n      }\n    } else {\n      updated.push(clientID)\n      if (!f.equalityDeep(prevState, state)) {\n        filteredUpdated.push(clientID)\n      }\n    }\n    if (added.length > 0 || filteredUpdated.length > 0 || removed.length > 0) {\n      this.emit('change', [{ added, updated: filteredUpdated, removed }, 'local'])\n    }\n    this.emit('update', [{ added, updated, removed }, 'local'])\n  }\n\n  /**\n   * @param {string} field\n   * @param {any} value\n   */\n  setLocalStateField (field, value) {\n    const state = this.getLocalState()\n    if (state !== null) {\n      this.setLocalState({\n        ...state,\n        [field]: value\n      })\n    }\n  }\n\n  /**\n   * @return {Map<number,Object<string,any>>}\n   */\n  getStates () {\n    return this.states\n  }\n}\n\n/**\n * Mark (remote) clients as inactive and remove them from the list of active peers.\n * This change will be propagated to remote clients.\n *\n * @param {Awareness} awareness\n * @param {Array<number>} clients\n * @param {any} origin\n */\nexport const removeAwarenessStates = (awareness, clients, origin) => {\n  const removed = []\n  for (let i = 0; i < clients.length; i++) {\n    const clientID = clients[i]\n    if (awareness.states.has(clientID)) {\n      awareness.states.delete(clientID)\n      if (clientID === awareness.clientID) {\n        const curMeta = /** @type {MetaClientState} */ (awareness.meta.get(clientID))\n        awareness.meta.set(clientID, {\n          clock: curMeta.clock + 1,\n          lastUpdated: time.getUnixTime()\n        })\n      }\n      removed.push(clientID)\n    }\n  }\n  if (removed.length > 0) {\n    awareness.emit('change', [{ added: [], updated: [], removed }, origin])\n    awareness.emit('update', [{ added: [], updated: [], removed }, origin])\n  }\n}\n\n/**\n * @param {Awareness} awareness\n * @param {Array<number>} clients\n * @return {Uint8Array}\n */\nexport const encodeAwarenessUpdate = (awareness, clients, states = awareness.states) => {\n  const len = clients.length\n  const encoder = encoding.createEncoder()\n  encoding.writeVarUint(encoder, len)\n  for (let i = 0; i < len; i++) {\n    const clientID = clients[i]\n    const state = states.get(clientID) || null\n    const clock = /** @type {MetaClientState} */ (awareness.meta.get(clientID)).clock\n    encoding.writeVarUint(encoder, clientID)\n    encoding.writeVarUint(encoder, clock)\n    encoding.writeVarString(encoder, JSON.stringify(state))\n  }\n  return encoding.toUint8Array(encoder)\n}\n\n/**\n * Modify the content of an awareness update before re-encoding it to an awareness update.\n *\n * This might be useful when you have a central server that wants to ensure that clients\n * cant hijack somebody elses identity.\n *\n * @param {Uint8Array} update\n * @param {function(any):any} modify\n * @return {Uint8Array}\n */\nexport const modifyAwarenessUpdate = (update, modify) => {\n  const decoder = decoding.createDecoder(update)\n  const encoder = encoding.createEncoder()\n  const len = decoding.readVarUint(decoder)\n  encoding.writeVarUint(encoder, len)\n  for (let i = 0; i < len; i++) {\n    const clientID = decoding.readVarUint(decoder)\n    const clock = decoding.readVarUint(decoder)\n    const state = JSON.parse(decoding.readVarString(decoder))\n    const modifiedState = modify(state)\n    encoding.writeVarUint(encoder, clientID)\n    encoding.writeVarUint(encoder, clock)\n    encoding.writeVarString(encoder, JSON.stringify(modifiedState))\n  }\n  return encoding.toUint8Array(encoder)\n}\n\n/**\n * @param {Awareness} awareness\n * @param {Uint8Array} update\n * @param {any} origin This will be added to the emitted change event\n */\nexport const applyAwarenessUpdate = (awareness, update, origin) => {\n  const decoder = decoding.createDecoder(update)\n  const timestamp = time.getUnixTime()\n  const added = []\n  const updated = []\n  const filteredUpdated = []\n  const removed = []\n  const len = decoding.readVarUint(decoder)\n  for (let i = 0; i < len; i++) {\n    const clientID = decoding.readVarUint(decoder)\n    let clock = decoding.readVarUint(decoder)\n    const state = JSON.parse(decoding.readVarString(decoder))\n    const clientMeta = awareness.meta.get(clientID)\n    const prevState = awareness.states.get(clientID)\n    const currClock = clientMeta === undefined ? 0 : clientMeta.clock\n    if (currClock < clock || (currClock === clock && state === null && awareness.states.has(clientID))) {\n      if (state === null) {\n        // never let a remote client remove this local state\n        if (clientID === awareness.clientID && awareness.getLocalState() != null) {\n          // remote client removed the local state. Do not remote state. Broadcast a message indicating\n          // that this client still exists by increasing the clock\n          clock++\n        } else {\n          awareness.states.delete(clientID)\n        }\n      } else {\n        awareness.states.set(clientID, state)\n      }\n      awareness.meta.set(clientID, {\n        clock,\n        lastUpdated: timestamp\n      })\n      if (clientMeta === undefined && state !== null) {\n        added.push(clientID)\n      } else if (clientMeta !== undefined && state === null) {\n        removed.push(clientID)\n      } else if (state !== null) {\n        if (!f.equalityDeep(state, prevState)) {\n          filteredUpdated.push(clientID)\n        }\n        updated.push(clientID)\n      }\n    }\n  }\n  if (added.length > 0 || filteredUpdated.length > 0 || removed.length > 0) {\n    awareness.emit('change', [{\n      added, updated: filteredUpdated, removed\n    }, origin])\n  }\n  if (added.length > 0 || updated.length > 0 || removed.length > 0) {\n    awareness.emit('update', [{\n      added, updated, removed\n    }, origin])\n  }\n}\n","/* -----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\nimport { JSONExt } from '@lumino/coreutils';\nimport { Signal } from '@lumino/signaling';\nimport { Awareness } from 'y-protocols/awareness';\nimport * as Y from 'yjs';\n/**\n * Generic shareable document.\n */\nexport class YDocument {\n    constructor(options) {\n        var _a;\n        /**\n         * Handle a change to the ystate.\n         */\n        this.onStateChanged = (event) => {\n            const stateChange = new Array();\n            event.keysChanged.forEach(key => {\n                const change = event.changes.keys.get(key);\n                if (change) {\n                    stateChange.push({\n                        name: key,\n                        oldValue: change.oldValue,\n                        newValue: this.ystate.get(key)\n                    });\n                }\n            });\n            this._changed.emit({ stateChange });\n        };\n        this._changed = new Signal(this);\n        this._isDisposed = false;\n        this._disposed = new Signal(this);\n        this._ydoc = (_a = options === null || options === void 0 ? void 0 : options.ydoc) !== null && _a !== void 0 ? _a : new Y.Doc();\n        this._ystate = this._ydoc.getMap('state');\n        this._undoManager = new Y.UndoManager([], {\n            trackedOrigins: new Set([this]),\n            doc: this._ydoc\n        });\n        this._awareness = new Awareness(this._ydoc);\n        this._ystate.observe(this.onStateChanged);\n    }\n    /**\n     * YJS document.\n     */\n    get ydoc() {\n        return this._ydoc;\n    }\n    /**\n     * Shared state\n     */\n    get ystate() {\n        return this._ystate;\n    }\n    /**\n     * YJS document undo manager\n     */\n    get undoManager() {\n        return this._undoManager;\n    }\n    /**\n     * Shared awareness\n     */\n    get awareness() {\n        return this._awareness;\n    }\n    /**\n     * The changed signal.\n     */\n    get changed() {\n        return this._changed;\n    }\n    /**\n     * A signal emitted when the document is disposed.\n     */\n    get disposed() {\n        return this._disposed;\n    }\n    /**\n     * Whether the document is disposed or not.\n     */\n    get isDisposed() {\n        return this._isDisposed;\n    }\n    /**\n     * Document state\n     */\n    get state() {\n        return JSONExt.deepCopy(this.ystate.toJSON());\n    }\n    /**\n     * Whether the object can undo changes.\n     */\n    canUndo() {\n        return this.undoManager.undoStack.length > 0;\n    }\n    /**\n     * Whether the object can redo changes.\n     */\n    canRedo() {\n        return this.undoManager.redoStack.length > 0;\n    }\n    /**\n     * Dispose of the resources.\n     */\n    dispose() {\n        if (this._isDisposed) {\n            return;\n        }\n        this._isDisposed = true;\n        this.ystate.unobserve(this.onStateChanged);\n        this.awareness.destroy();\n        this.undoManager.destroy();\n        this.ydoc.destroy();\n        this._disposed.emit();\n        Signal.clearData(this);\n    }\n    /**\n     * Get the value for a state attribute\n     *\n     * @param key Key to get\n     */\n    getState(key) {\n        const value = this.ystate.get(key);\n        return typeof value === 'undefined'\n            ? value\n            : JSONExt.deepCopy(value);\n    }\n    /**\n     * Set the value of a state attribute\n     *\n     * @param key Key to set\n     * @param value New attribute value\n     */\n    setState(key, value) {\n        if (!JSONExt.deepEqual(this.ystate.get(key), value)) {\n            this.ystate.set(key, value);\n        }\n    }\n    /**\n     * Get the document source\n     *\n     * @returns The source\n     */\n    get source() {\n        return this.getSource();\n    }\n    /**\n     * Set the document source\n     *\n     * @param value The source to set\n     */\n    set source(value) {\n        this.setSource(value);\n    }\n    /**\n     * Undo an operation.\n     */\n    undo() {\n        this.undoManager.undo();\n    }\n    /**\n     * Redo an operation.\n     */\n    redo() {\n        this.undoManager.redo();\n    }\n    /**\n     * Clear the change stack.\n     */\n    clearUndoHistory() {\n        this.undoManager.clear();\n    }\n    /**\n     * Perform a transaction. While the function f is called, all changes to the shared\n     * document are bundled into a single event.\n     */\n    transact(f, undoable = true, origin = null) {\n        this.ydoc.transact(f, undoable ? this : origin);\n    }\n}\n//# sourceMappingURL=ydocument.js.map","/* -----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\nimport { YDocument } from './ydocument.js';\n/**\n * Shareable text file.\n */\nexport class YFile extends YDocument {\n    /**\n     * Create a new file\n     *\n     * #### Notes\n     * The document is empty and must be populated\n     */\n    constructor() {\n        super();\n        /**\n         * Document version\n         */\n        this.version = '1.0.0';\n        /**\n         * YJS file text.\n         */\n        this.ysource = this.ydoc.getText('source');\n        /**\n         * Handle a change to the ymodel.\n         */\n        this._modelObserver = (event) => {\n            this._changed.emit({ sourceChange: event.changes.delta });\n        };\n        this.undoManager.addToScope(this.ysource);\n        this.ysource.observe(this._modelObserver);\n    }\n    /**\n     * Creates a standalone YFile\n     */\n    static create() {\n        return new YFile();\n    }\n    /**\n     * File text\n     */\n    get source() {\n        return this.getSource();\n    }\n    set source(v) {\n        this.setSource(v);\n    }\n    /**\n     * Dispose of the resources.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        this.ysource.unobserve(this._modelObserver);\n        super.dispose();\n    }\n    /**\n     * Get the file text.\n     *\n     * @returns File text.\n     */\n    getSource() {\n        return this.ysource.toString();\n    }\n    /**\n     * Set the file text.\n     *\n     * @param value New text\n     */\n    setSource(value) {\n        this.transact(() => {\n            const ytext = this.ysource;\n            ytext.delete(0, ytext.length);\n            ytext.insert(0, value);\n        });\n    }\n    /**\n     * Replace content from `start' to `end` with `value`.\n     *\n     * @param start: The start index of the range to replace (inclusive).\n     * @param end: The end index of the range to replace (exclusive).\n     * @param value: New source (optional).\n     */\n    updateSource(start, end, value = '') {\n        this.transact(() => {\n            const ysource = this.ysource;\n            // insert and then delete.\n            // This ensures that the cursor position is adjusted after the replaced content.\n            ysource.insert(start, value);\n            ysource.delete(start + value.length, end - start);\n        });\n    }\n}\n//# sourceMappingURL=yfile.js.map","/* -----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\nimport { JSONExt, UUID } from '@lumino/coreutils';\nimport { Signal } from '@lumino/signaling';\nimport { Awareness } from 'y-protocols/awareness';\nimport * as Y from 'yjs';\n/**\n * Create a new shared cell model given the YJS shared type.\n */\nexport const createCellModelFromSharedType = (type, options = {}) => {\n    switch (type.get('cell_type')) {\n        case 'code':\n            return new YCodeCell(type, type.get('source'), type.get('outputs'), options);\n        case 'markdown':\n            return new YMarkdownCell(type, type.get('source'), options);\n        case 'raw':\n            return new YRawCell(type, type.get('source'), options);\n        default:\n            throw new Error('Found unknown cell type');\n    }\n};\n/**\n * Create a new cell that can be inserted in an existing shared model.\n *\n * If no notebook is specified the cell will be standalone.\n *\n * @param cell Cell JSON representation\n * @param notebook Notebook to which the cell will be added\n */\nexport const createCell = (cell, notebook) => {\n    var _a, _b;\n    const ymodel = new Y.Map();\n    const ysource = new Y.Text();\n    const ymetadata = new Y.Map();\n    ymodel.set('source', ysource);\n    ymodel.set('metadata', ymetadata);\n    ymodel.set('cell_type', cell.cell_type);\n    ymodel.set('id', (_a = cell.id) !== null && _a !== void 0 ? _a : UUID.uuid4());\n    let ycell;\n    switch (cell.cell_type) {\n        case 'markdown': {\n            ycell = new YMarkdownCell(ymodel, ysource, { notebook }, ymetadata);\n            if (cell.attachments != null) {\n                ycell.setAttachments(cell.attachments);\n            }\n            break;\n        }\n        case 'code': {\n            const youtputs = new Y.Array();\n            ymodel.set('outputs', youtputs);\n            ycell = new YCodeCell(ymodel, ysource, youtputs, {\n                notebook\n            }, ymetadata);\n            const cCell = cell;\n            ycell.execution_count = (_b = cCell.execution_count) !== null && _b !== void 0 ? _b : null;\n            if (cCell.outputs) {\n                ycell.setOutputs(cCell.outputs);\n            }\n            break;\n        }\n        default: {\n            // raw\n            ycell = new YRawCell(ymodel, ysource, { notebook }, ymetadata);\n            if (cell.attachments) {\n                ycell.setAttachments(cell.attachments);\n            }\n            break;\n        }\n    }\n    if (cell.metadata != null) {\n        ycell.setMetadata(cell.metadata);\n    }\n    if (cell.source != null) {\n        ycell.setSource(typeof cell.source === 'string' ? cell.source : cell.source.join(''));\n    }\n    return ycell;\n};\n/**\n * Create a new cell that cannot be inserted in an existing shared model.\n *\n * @param cell Cell JSON representation\n */\nexport const createStandaloneCell = (cell) => createCell(cell);\nexport class YBaseCell {\n    /**\n     * Create a new YCell that works standalone. It cannot be\n     * inserted into a YNotebook because the Yjs model is already\n     * attached to an anonymous Y.Doc instance.\n     */\n    static create(id) {\n        return createCell({ id, cell_type: this.prototype.cell_type });\n    }\n    /**\n     * Base cell constructor\n     *\n     * ### Notes\n     * Don't use the constructor directly - prefer using ``YNotebook.insertCell``\n     *\n     * The ``ysource`` is needed because ``ymodel.get('source')`` will\n     * not return the real source if the model is not yet attached to\n     * a document. Requesting it explicitly allows to introspect a non-empty\n     * source before the cell is attached to the document.\n     *\n     * @param ymodel Cell map\n     * @param ysource Cell source\n     * @param options \\{ notebook?: The notebook the cell is attached to \\}\n     * @param ymetadata Cell metadata\n     */\n    constructor(ymodel, ysource, options = {}, ymetadata) {\n        /**\n         * Handle a change to the ymodel.\n         */\n        this._modelObserver = (events, transaction) => {\n            if (transaction.origin !== 'silent-change') {\n                this._changed.emit(this.getChanges(events));\n            }\n        };\n        this._metadataChanged = new Signal(this);\n        /**\n         * The notebook that this cell belongs to.\n         */\n        this._notebook = null;\n        this._changed = new Signal(this);\n        this._disposed = new Signal(this);\n        this._isDisposed = false;\n        this._undoManager = null;\n        this.ymodel = ymodel;\n        this._ysource = ysource;\n        this._ymetadata = ymetadata !== null && ymetadata !== void 0 ? ymetadata : this.ymodel.get('metadata');\n        this._prevSourceLength = ysource ? ysource.length : 0;\n        this._notebook = null;\n        this._awareness = null;\n        this._undoManager = null;\n        if (options.notebook) {\n            this._notebook = options.notebook;\n            if (this._notebook.disableDocumentWideUndoRedo) {\n                this._undoManager = new Y.UndoManager([this.ymodel], {\n                    trackedOrigins: new Set([this]),\n                    doc: this._notebook.ydoc\n                });\n            }\n        }\n        else {\n            // Standalone cell\n            const doc = new Y.Doc();\n            doc.getArray().insert(0, [this.ymodel]);\n            this._awareness = new Awareness(doc);\n            this._undoManager = new Y.UndoManager([this.ymodel], {\n                trackedOrigins: new Set([this])\n            });\n        }\n        this.ymodel.observeDeep(this._modelObserver);\n    }\n    /**\n     * Cell notebook awareness or null.\n     */\n    get awareness() {\n        var _a, _b, _c;\n        return (_c = (_a = this._awareness) !== null && _a !== void 0 ? _a : (_b = this.notebook) === null || _b === void 0 ? void 0 : _b.awareness) !== null && _c !== void 0 ? _c : null;\n    }\n    /**\n     * The type of the cell.\n     */\n    get cell_type() {\n        throw new Error('A YBaseCell must not be constructed');\n    }\n    /**\n     * The changed signal.\n     */\n    get changed() {\n        return this._changed;\n    }\n    /**\n     * Signal emitted when the cell is disposed.\n     */\n    get disposed() {\n        return this._disposed;\n    }\n    /**\n     * Cell id\n     */\n    get id() {\n        return this.getId();\n    }\n    /**\n     * Whether the model has been disposed or not.\n     */\n    get isDisposed() {\n        return this._isDisposed;\n    }\n    /**\n     * Whether the cell is standalone or not.\n     *\n     * If the cell is standalone. It cannot be\n     * inserted into a YNotebook because the Yjs model is already\n     * attached to an anonymous Y.Doc instance.\n     */\n    get isStandalone() {\n        return this._notebook !== null;\n    }\n    /**\n     * Cell metadata.\n     *\n     * #### Notes\n     * You should prefer to access and modify the specific key of interest.\n     */\n    get metadata() {\n        return this.getMetadata();\n    }\n    set metadata(v) {\n        this.setMetadata(v);\n    }\n    /**\n     * Signal triggered when the cell metadata changes.\n     */\n    get metadataChanged() {\n        return this._metadataChanged;\n    }\n    /**\n     * The notebook that this cell belongs to.\n     */\n    get notebook() {\n        return this._notebook;\n    }\n    /**\n     * Cell input content.\n     */\n    get source() {\n        return this.getSource();\n    }\n    set source(v) {\n        this.setSource(v);\n    }\n    /**\n     * The cell undo manager.\n     */\n    get undoManager() {\n        var _a;\n        if (!this.notebook) {\n            return this._undoManager;\n        }\n        return ((_a = this.notebook) === null || _a === void 0 ? void 0 : _a.disableDocumentWideUndoRedo)\n            ? this._undoManager\n            : this.notebook.undoManager;\n    }\n    get ysource() {\n        return this._ysource;\n    }\n    /**\n     * Whether the object can undo changes.\n     */\n    canUndo() {\n        return !!this.undoManager && this.undoManager.undoStack.length > 0;\n    }\n    /**\n     * Whether the object can redo changes.\n     */\n    canRedo() {\n        return !!this.undoManager && this.undoManager.redoStack.length > 0;\n    }\n    /**\n     * Clear the change stack.\n     */\n    clearUndoHistory() {\n        var _a;\n        (_a = this.undoManager) === null || _a === void 0 ? void 0 : _a.clear();\n    }\n    /**\n     * Undo an operation.\n     */\n    undo() {\n        var _a;\n        (_a = this.undoManager) === null || _a === void 0 ? void 0 : _a.undo();\n    }\n    /**\n     * Redo an operation.\n     */\n    redo() {\n        var _a;\n        (_a = this.undoManager) === null || _a === void 0 ? void 0 : _a.redo();\n    }\n    /**\n     * Dispose of the resources.\n     */\n    dispose() {\n        var _a;\n        if (this._isDisposed)\n            return;\n        this._isDisposed = true;\n        this.ymodel.unobserveDeep(this._modelObserver);\n        if (this._awareness) {\n            // A new document is created for standalone cell.\n            const doc = this._awareness.doc;\n            this._awareness.destroy();\n            doc.destroy();\n        }\n        if (this._undoManager) {\n            // Be sure to not destroy the document undo manager.\n            if (this._undoManager === ((_a = this.notebook) === null || _a === void 0 ? void 0 : _a.undoManager)) {\n                this._undoManager = null;\n            }\n            else {\n                this._undoManager.destroy();\n            }\n        }\n        this._disposed.emit();\n        Signal.clearData(this);\n    }\n    /**\n     * Get cell id.\n     *\n     * @returns Cell id\n     */\n    getId() {\n        return this.ymodel.get('id');\n    }\n    /**\n     * Gets cell's source.\n     *\n     * @returns Cell's source.\n     */\n    getSource() {\n        return this.ysource.toString();\n    }\n    /**\n     * Sets cell's source.\n     *\n     * @param value: New source.\n     */\n    setSource(value) {\n        this.transact(() => {\n            this.ysource.delete(0, this.ysource.length);\n            this.ysource.insert(0, value);\n        });\n        // @todo Do we need proper replace semantic? This leads to issues in editor bindings because they don't switch source.\n        // this.ymodel.set('source', new Y.Text(value));\n    }\n    /**\n     * Replace content from `start' to `end` with `value`.\n     *\n     * @param start: The start index of the range to replace (inclusive).\n     *\n     * @param end: The end index of the range to replace (exclusive).\n     *\n     * @param value: New source (optional).\n     */\n    updateSource(start, end, value = '') {\n        this.transact(() => {\n            const ysource = this.ysource;\n            // insert and then delete.\n            // This ensures that the cursor position is adjusted after the replaced content.\n            ysource.insert(start, value);\n            ysource.delete(start + value.length, end - start);\n        });\n    }\n    /**\n     * Delete a metadata cell.\n     *\n     * @param key The key to delete\n     */\n    deleteMetadata(key) {\n        if (typeof this.getMetadata(key) === 'undefined') {\n            return;\n        }\n        this.transact(() => {\n            this._ymetadata.delete(key);\n            const jupyter = this.getMetadata('jupyter');\n            if (key === 'collapsed' && jupyter) {\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                const { outputs_hidden, ...others } = jupyter;\n                if (Object.keys(others).length === 0) {\n                    this._ymetadata.delete('jupyter');\n                }\n                else {\n                    this._ymetadata.set('jupyter', others);\n                }\n            }\n            else if (key === 'jupyter') {\n                this._ymetadata.delete('collapsed');\n            }\n        }, false);\n    }\n    getMetadata(key) {\n        const metadata = this._ymetadata;\n        // Transiently the metadata can be missing - like during destruction\n        if (metadata === undefined) {\n            return undefined;\n        }\n        if (typeof key === 'string') {\n            const value = metadata.get(key);\n            return typeof value === 'undefined'\n                ? undefined // undefined is converted to `{}` by `JSONExt.deepCopy`\n                : JSONExt.deepCopy(metadata.get(key));\n        }\n        else {\n            return JSONExt.deepCopy(metadata.toJSON());\n        }\n    }\n    setMetadata(metadata, value) {\n        var _a, _b;\n        if (typeof metadata === 'string') {\n            if (typeof value === 'undefined') {\n                throw new TypeError(`Metadata value for ${metadata} cannot be 'undefined'; use deleteMetadata.`);\n            }\n            const key = metadata;\n            // Only set metadata if we change something to avoid infinite\n            // loop of signal changes.\n            if (JSONExt.deepEqual((_a = this.getMetadata(key)) !== null && _a !== void 0 ? _a : null, value)) {\n                return;\n            }\n            this.transact(() => {\n                var _a;\n                this._ymetadata.set(key, value);\n                if (key === 'collapsed') {\n                    const jupyter = ((_a = this.getMetadata('jupyter')) !== null && _a !== void 0 ? _a : {});\n                    if (jupyter.outputs_hidden !== value) {\n                        this.setMetadata('jupyter', {\n                            ...jupyter,\n                            outputs_hidden: value\n                        });\n                    }\n                }\n                else if (key === 'jupyter') {\n                    const isHidden = value['outputs_hidden'];\n                    if (typeof isHidden !== 'undefined') {\n                        if (this.getMetadata('collapsed') !== isHidden) {\n                            this.setMetadata('collapsed', isHidden);\n                        }\n                    }\n                    else {\n                        this.deleteMetadata('collapsed');\n                    }\n                }\n            }, false);\n        }\n        else {\n            const clone = JSONExt.deepCopy(metadata);\n            if (clone.collapsed != null) {\n                clone.jupyter = clone.jupyter || {};\n                clone.jupyter.outputs_hidden = clone.collapsed;\n            }\n            else if (((_b = clone === null || clone === void 0 ? void 0 : clone.jupyter) === null || _b === void 0 ? void 0 : _b.outputs_hidden) != null) {\n                clone.collapsed = clone.jupyter.outputs_hidden;\n            }\n            if (!JSONExt.deepEqual(clone, this.getMetadata())) {\n                this.transact(() => {\n                    for (const [key, value] of Object.entries(clone)) {\n                        this._ymetadata.set(key, value);\n                    }\n                }, false);\n            }\n        }\n    }\n    /**\n     * Serialize the model to JSON.\n     */\n    toJSON() {\n        return {\n            id: this.getId(),\n            cell_type: this.cell_type,\n            source: this.getSource(),\n            metadata: this.getMetadata()\n        };\n    }\n    /**\n     * Perform a transaction. While the function f is called, all changes to the shared\n     * document are bundled into a single event.\n     *\n     * @param f Transaction to execute\n     * @param undoable Whether to track the change in the action history or not (default `true`)\n     */\n    transact(f, undoable = true, origin = null) {\n        !this.notebook || this.notebook.disableDocumentWideUndoRedo\n            ? this.ymodel.doc == null\n                ? f()\n                : this.ymodel.doc.transact(f, undoable ? this : origin)\n            : this.notebook.transact(f, undoable);\n    }\n    /**\n     * Extract changes from YJS events\n     *\n     * @param events YJS events\n     * @returns Cell changes\n     */\n    getChanges(events) {\n        const changes = {};\n        const sourceEvent = events.find(event => event.target === this.ymodel.get('source'));\n        if (sourceEvent) {\n            changes.sourceChange = sourceEvent.changes.delta;\n        }\n        const metadataEvents = events.find(event => event.target === this._ymetadata);\n        if (metadataEvents) {\n            changes.metadataChange = metadataEvents.changes.keys;\n            metadataEvents.changes.keys.forEach((change, key) => {\n                switch (change.action) {\n                    case 'add':\n                        this._metadataChanged.emit({\n                            key,\n                            newValue: this._ymetadata.get(key),\n                            type: 'add'\n                        });\n                        break;\n                    case 'delete':\n                        this._metadataChanged.emit({\n                            key,\n                            oldValue: change.oldValue,\n                            type: 'remove'\n                        });\n                        break;\n                    case 'update':\n                        {\n                            const newValue = this._ymetadata.get(key);\n                            const oldValue = change.oldValue;\n                            let equal = true;\n                            if (typeof oldValue == 'object' && typeof newValue == 'object') {\n                                equal = JSONExt.deepEqual(oldValue, newValue);\n                            }\n                            else {\n                                equal = oldValue === newValue;\n                            }\n                            if (!equal) {\n                                this._metadataChanged.emit({\n                                    key,\n                                    type: 'change',\n                                    oldValue,\n                                    newValue\n                                });\n                            }\n                        }\n                        break;\n                }\n            });\n        }\n        const modelEvent = events.find(event => event.target === this.ymodel);\n        // The model allows us to replace the complete source with a new string. We express this in the Delta format\n        // as a replace of the complete string.\n        const ysource = this.ymodel.get('source');\n        if (modelEvent && modelEvent.keysChanged.has('source')) {\n            changes.sourceChange = [\n                { delete: this._prevSourceLength },\n                { insert: ysource.toString() }\n            ];\n        }\n        this._prevSourceLength = ysource.length;\n        return changes;\n    }\n}\n/**\n * Shareable code cell.\n */\nexport class YCodeCell extends YBaseCell {\n    /**\n     * Create a new YCodeCell that works standalone. It cannot be\n     * inserted into a YNotebook because the Yjs model is already\n     * attached to an anonymous Y.Doc instance.\n     */\n    static create(id) {\n        return super.create(id);\n    }\n    /**\n     * Code cell constructor\n     *\n     * ### Notes\n     * Don't use the constructor directly - prefer using ``YNotebook.insertCell``\n     *\n     * The ``ysource`` is needed because ``ymodel.get('source')`` will\n     * not return the real source if the model is not yet attached to\n     * a document. Requesting it explicitly allows to introspect a non-empty\n     * source before the cell is attached to the document.\n     *\n     * @param ymodel Cell map\n     * @param ysource Cell source\n     * @param youtputs Code cell outputs\n     * @param options \\{ notebook?: The notebook the cell is attached to \\}\n     * @param ymetadata Cell metadata\n     */\n    constructor(ymodel, ysource, youtputs, options = {}, ymetadata) {\n        super(ymodel, ysource, options, ymetadata);\n        this._youtputs = youtputs;\n    }\n    /**\n     * The type of the cell.\n     */\n    get cell_type() {\n        return 'code';\n    }\n    /**\n     * The code cell's prompt number. Will be null if the cell has not been run.\n     */\n    get execution_count() {\n        return this.ymodel.get('execution_count') || null;\n    }\n    set execution_count(count) {\n        // Do not use `this.execution_count`. When initializing the\n        // cell, we need to set execution_count to `null` if we compare\n        // using `this.execution_count` it will return `null` and we will\n        // never initialize it\n        if (this.ymodel.get('execution_count') !== count) {\n            this.transact(() => {\n                this.ymodel.set('execution_count', count);\n            }, false);\n        }\n    }\n    /**\n     * The code cell's execution state.\n     */\n    get executionState() {\n        var _a;\n        return (_a = this.ymodel.get('execution_state')) !== null && _a !== void 0 ? _a : 'idle';\n    }\n    set executionState(state) {\n        if (this.ymodel.get('execution_state') !== state) {\n            this.transact(() => {\n                this.ymodel.set('execution_state', state);\n            }, false);\n        }\n    }\n    /**\n     * Cell outputs.\n     */\n    get outputs() {\n        return this.getOutputs();\n    }\n    set outputs(v) {\n        this.setOutputs(v);\n    }\n    get youtputs() {\n        return this._youtputs;\n    }\n    /**\n     * Execution, display, or stream outputs.\n     */\n    getOutputs() {\n        return JSONExt.deepCopy(this._youtputs.toJSON());\n    }\n    createOutputs(outputs) {\n        const newOutputs = [];\n        for (const output of JSONExt.deepCopy(outputs)) {\n            let _newOutput1;\n            if (output.output_type === 'stream') {\n                // Set the text field as a Y.Text\n                const { text, ...outputWithoutText } = output;\n                _newOutput1 = outputWithoutText;\n                const newText = new Y.Text();\n                let _text = text instanceof Array ? text.join() : text;\n                newText.insert(0, _text);\n                _newOutput1['text'] = newText;\n            }\n            else {\n                _newOutput1 = output;\n            }\n            const _newOutput2 = [];\n            for (const [key, value] of Object.entries(_newOutput1)) {\n                _newOutput2.push([key, value]);\n            }\n            const newOutput = new Y.Map(_newOutput2);\n            newOutputs.push(newOutput);\n        }\n        return newOutputs;\n    }\n    /**\n     * Replace all outputs.\n     */\n    setOutputs(outputs) {\n        this.transact(() => {\n            this._youtputs.delete(0, this._youtputs.length);\n            const newOutputs = this.createOutputs(outputs);\n            this._youtputs.insert(0, newOutputs);\n        }, false);\n    }\n    /**\n     * Remove text from a stream output.\n     */\n    removeStreamOutput(index, start, origin = null) {\n        this.transact(() => {\n            const output = this._youtputs.get(index);\n            const prevText = output.get('text');\n            const length = prevText.length - start;\n            prevText.delete(start, length);\n        }, false, origin);\n    }\n    /**\n     * Append text to a stream output.\n     */\n    appendStreamOutput(index, text, origin = null) {\n        this.transact(() => {\n            const output = this._youtputs.get(index);\n            const prevText = output.get('text');\n            prevText.insert(prevText.length, text);\n        }, false, origin);\n    }\n    /**\n     * Replace content from `start' to `end` with `outputs`.\n     *\n     * @param start: The start index of the range to replace (inclusive).\n     *\n     * @param end: The end index of the range to replace (exclusive).\n     *\n     * @param outputs: New outputs (optional).\n     */\n    updateOutputs(start, end, outputs = [], origin = null) {\n        const fin = end < this._youtputs.length ? end - start : this._youtputs.length - start;\n        this.transact(() => {\n            this._youtputs.delete(start, fin);\n            const newOutputs = this.createOutputs(outputs);\n            this._youtputs.insert(start, newOutputs);\n        }, false, origin);\n    }\n    /**\n     * Serialize the model to JSON.\n     */\n    toJSON() {\n        return {\n            ...super.toJSON(),\n            outputs: this.getOutputs(),\n            execution_count: this.execution_count\n        };\n    }\n    /**\n     * Extract changes from YJS events\n     *\n     * @param events YJS events\n     * @returns Cell changes\n     */\n    getChanges(events) {\n        const changes = super.getChanges(events);\n        const streamOutputEvent = events.find(\n        // Changes to the 'text' of a cell's stream output can be accessed like so:\n        // ycell['outputs'][output_idx]['text']\n        // This translates to an event path of: ['outputs', output_idx, 'text]\n        event => event.path.length === 3 &&\n            event.path[0] === 'outputs' &&\n            event.path[2] === 'text');\n        if (streamOutputEvent) {\n            changes.streamOutputChange = streamOutputEvent.changes.delta;\n        }\n        const outputEvent = events.find(event => event.target === this.ymodel.get('outputs'));\n        if (outputEvent) {\n            changes.outputsChange = outputEvent.changes.delta;\n        }\n        const modelEvent = events.find(event => event.target === this.ymodel);\n        if (modelEvent && modelEvent.keysChanged.has('execution_count')) {\n            const change = modelEvent.changes.keys.get('execution_count');\n            changes.executionCountChange = {\n                oldValue: change.oldValue,\n                newValue: this.ymodel.get('execution_count')\n            };\n        }\n        if (modelEvent && modelEvent.keysChanged.has('execution_state')) {\n            const change = modelEvent.changes.keys.get('execution_state');\n            changes.executionStateChange = {\n                oldValue: change.oldValue,\n                newValue: this.ymodel.get('execution_state')\n            };\n        }\n        return changes;\n    }\n}\nclass YAttachmentCell extends YBaseCell {\n    /**\n     * Cell attachments\n     */\n    get attachments() {\n        return this.getAttachments();\n    }\n    set attachments(v) {\n        this.setAttachments(v);\n    }\n    /**\n     * Gets the cell attachments.\n     *\n     * @returns The cell attachments.\n     */\n    getAttachments() {\n        return this.ymodel.get('attachments');\n    }\n    /**\n     * Sets the cell attachments\n     *\n     * @param attachments: The cell attachments.\n     */\n    setAttachments(attachments) {\n        this.transact(() => {\n            if (attachments == null) {\n                this.ymodel.delete('attachments');\n            }\n            else {\n                this.ymodel.set('attachments', attachments);\n            }\n        }, false);\n    }\n    /**\n     * Extract changes from YJS events\n     *\n     * @param events YJS events\n     * @returns Cell changes\n     */\n    getChanges(events) {\n        const changes = super.getChanges(events);\n        const modelEvent = events.find(event => event.target === this.ymodel);\n        if (modelEvent && modelEvent.keysChanged.has('attachments')) {\n            const change = modelEvent.changes.keys.get('attachments');\n            changes.attachmentsChange = {\n                oldValue: change.oldValue,\n                newValue: this.ymodel.get('attachments')\n            };\n        }\n        return changes;\n    }\n}\n/**\n * Shareable raw cell.\n */\nexport class YRawCell extends YAttachmentCell {\n    /**\n     * Create a new YRawCell that works standalone. It cannot be\n     * inserted into a YNotebook because the Yjs model is already\n     * attached to an anonymous Y.Doc instance.\n     */\n    static create(id) {\n        return super.create(id);\n    }\n    /**\n     * String identifying the type of cell.\n     */\n    get cell_type() {\n        return 'raw';\n    }\n    /**\n     * Serialize the model to JSON.\n     */\n    toJSON() {\n        return {\n            id: this.getId(),\n            cell_type: 'raw',\n            source: this.getSource(),\n            metadata: this.getMetadata(),\n            attachments: this.getAttachments()\n        };\n    }\n}\n/**\n * Shareable markdown cell.\n */\nexport class YMarkdownCell extends YAttachmentCell {\n    /**\n     * Create a new YMarkdownCell that works standalone. It cannot be\n     * inserted into a YNotebook because the Yjs model is already\n     * attached to an anonymous Y.Doc instance.\n     */\n    static create(id) {\n        return super.create(id);\n    }\n    /**\n     * String identifying the type of cell.\n     */\n    get cell_type() {\n        return 'markdown';\n    }\n    /**\n     * Serialize the model to JSON.\n     */\n    toJSON() {\n        return {\n            id: this.getId(),\n            cell_type: 'markdown',\n            source: this.getSource(),\n            metadata: this.getMetadata(),\n            attachments: this.getAttachments()\n        };\n    }\n}\n//# sourceMappingURL=ycell.js.map","/* -----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\nimport { JSONExt } from '@lumino/coreutils';\nimport { Signal } from '@lumino/signaling';\nimport * as Y from 'yjs';\nimport { YDocument } from './ydocument.js';\nimport { createCell, createCellModelFromSharedType } from './ycell.js';\n/**\n * Shared implementation of the Shared Document types.\n *\n * Shared cells can be inserted into a SharedNotebook.\n * Shared cells only start emitting events when they are connected to a SharedNotebook.\n *\n * \"Standalone\" cells must not be inserted into a (Shared)Notebook.\n * Standalone cells emit events immediately after they have been created, but they must not\n * be included into a (Shared)Notebook.\n */\nexport class YNotebook extends YDocument {\n    /**\n     * Create a new notebook\n     *\n     * #### Notes\n     * The document is empty and must be populated\n     *\n     * @param options\n     */\n    constructor(options = {}) {\n        var _a;\n        super();\n        /**\n         * Document version\n         */\n        this.version = '2.0.0';\n        /**\n         * YJS map for the notebook metadata\n         */\n        this.ymeta = this.ydoc.getMap('meta');\n        /**\n         * Handle a change to the ystate.\n         */\n        this._onMetaChanged = (events) => {\n            const metadataEvents = events.find(event => event.target === this.ymeta.get('metadata'));\n            if (metadataEvents) {\n                const metadataChange = metadataEvents.changes.keys;\n                const ymetadata = this.ymeta.get('metadata');\n                metadataEvents.changes.keys.forEach((change, key) => {\n                    switch (change.action) {\n                        case 'add':\n                            this._metadataChanged.emit({\n                                key,\n                                type: 'add',\n                                newValue: ymetadata.get(key)\n                            });\n                            break;\n                        case 'delete':\n                            this._metadataChanged.emit({\n                                key,\n                                type: 'remove',\n                                oldValue: change.oldValue\n                            });\n                            break;\n                        case 'update':\n                            {\n                                const newValue = ymetadata.get(key);\n                                const oldValue = change.oldValue;\n                                let equal = true;\n                                if (typeof oldValue == 'object' && typeof newValue == 'object') {\n                                    equal = JSONExt.deepEqual(oldValue, newValue);\n                                }\n                                else {\n                                    equal = oldValue === newValue;\n                                }\n                                if (!equal) {\n                                    this._metadataChanged.emit({\n                                        key,\n                                        type: 'change',\n                                        oldValue,\n                                        newValue\n                                    });\n                                }\n                            }\n                            break;\n                    }\n                });\n                this._changed.emit({ metadataChange });\n            }\n            const metaEvent = events.find(event => event.target === this.ymeta);\n            if (!metaEvent) {\n                return;\n            }\n            if (metaEvent.keysChanged.has('metadata')) {\n                // Handle metadata change when adding/removing the YMap\n                const change = metaEvent.changes.keys.get('metadata');\n                if ((change === null || change === void 0 ? void 0 : change.action) === 'add' && !change.oldValue) {\n                    const metadataChange = new Map();\n                    for (const key of Object.keys(this.metadata)) {\n                        metadataChange.set(key, {\n                            action: 'add',\n                            oldValue: undefined\n                        });\n                        this._metadataChanged.emit({\n                            key,\n                            type: 'add',\n                            newValue: this.getMetadata(key)\n                        });\n                    }\n                    this._changed.emit({ metadataChange });\n                }\n            }\n            if (metaEvent.keysChanged.has('nbformat')) {\n                const change = metaEvent.changes.keys.get('nbformat');\n                const nbformatChanged = {\n                    key: 'nbformat',\n                    oldValue: (change === null || change === void 0 ? void 0 : change.oldValue) ? change.oldValue : undefined,\n                    newValue: this.nbformat\n                };\n                this._changed.emit({ nbformatChanged });\n            }\n            if (metaEvent.keysChanged.has('nbformat_minor')) {\n                const change = metaEvent.changes.keys.get('nbformat_minor');\n                const nbformatChanged = {\n                    key: 'nbformat_minor',\n                    oldValue: (change === null || change === void 0 ? void 0 : change.oldValue) ? change.oldValue : undefined,\n                    newValue: this.nbformat_minor\n                };\n                this._changed.emit({ nbformatChanged });\n            }\n        };\n        /**\n         * Handle a change to the list of cells.\n         */\n        this._onYCellsChanged = (event) => {\n            // update the type cell mapping by iterating through the added/removed types\n            event.changes.added.forEach(item => {\n                const type = item.content.type;\n                if (!this._ycellMapping.has(type)) {\n                    const c = createCellModelFromSharedType(type, { notebook: this });\n                    this._ycellMapping.set(type, c);\n                }\n            });\n            event.changes.deleted.forEach(item => {\n                const type = item.content.type;\n                const model = this._ycellMapping.get(type);\n                if (model) {\n                    model.dispose();\n                    this._ycellMapping.delete(type);\n                }\n            });\n            let index = 0;\n            // this reflects the event.changes.delta, but replaces the content of delta.insert with ycells\n            const cellsChange = [];\n            event.changes.delta.forEach((d) => {\n                if (d.insert != null) {\n                    const insertedCells = d.insert.map((ycell) => this._ycellMapping.get(ycell));\n                    cellsChange.push({ insert: insertedCells });\n                    this.cells.splice(index, 0, ...insertedCells);\n                    index += d.insert.length;\n                }\n                else if (d.delete != null) {\n                    cellsChange.push(d);\n                    this.cells.splice(index, d.delete);\n                }\n                else if (d.retain != null) {\n                    cellsChange.push(d);\n                    index += d.retain;\n                }\n            });\n            this._changed.emit({\n                cellsChange: cellsChange\n            });\n        };\n        this._metadataChanged = new Signal(this);\n        /**\n         * Internal Yjs cells list\n         */\n        this._ycells = this.ydoc.getArray('cells');\n        this._ycellMapping = new WeakMap();\n        this._disableDocumentWideUndoRedo =\n            (_a = options.disableDocumentWideUndoRedo) !== null && _a !== void 0 ? _a : false;\n        this.cells = this._ycells.toArray().map(ycell => {\n            if (!this._ycellMapping.has(ycell)) {\n                this._ycellMapping.set(ycell, createCellModelFromSharedType(ycell, { notebook: this }));\n            }\n            return this._ycellMapping.get(ycell);\n        });\n        this.undoManager.addToScope(this._ycells);\n        this._ycells.observe(this._onYCellsChanged);\n        this.ymeta.observeDeep(this._onMetaChanged);\n    }\n    /**\n     * Creates a standalone YNotebook\n     *\n     * Note: This method is useful when we need to initialize\n     * the YNotebook from the JavaScript side.\n     */\n    static create(options = {}) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        const ynotebook = new YNotebook({\n            disableDocumentWideUndoRedo: (_a = options.disableDocumentWideUndoRedo) !== null && _a !== void 0 ? _a : false\n        });\n        const data = {\n            cells: (_c = (_b = options.data) === null || _b === void 0 ? void 0 : _b.cells) !== null && _c !== void 0 ? _c : [],\n            nbformat: (_e = (_d = options.data) === null || _d === void 0 ? void 0 : _d.nbformat) !== null && _e !== void 0 ? _e : 4,\n            nbformat_minor: (_g = (_f = options.data) === null || _f === void 0 ? void 0 : _f.nbformat_minor) !== null && _g !== void 0 ? _g : 5,\n            metadata: (_j = (_h = options.data) === null || _h === void 0 ? void 0 : _h.metadata) !== null && _j !== void 0 ? _j : {}\n        };\n        ynotebook.fromJSON(data);\n        return ynotebook;\n    }\n    /**\n     * Wether the undo/redo logic should be\n     * considered on the full document across all cells.\n     *\n     * Default: false\n     */\n    get disableDocumentWideUndoRedo() {\n        return this._disableDocumentWideUndoRedo;\n    }\n    /**\n     * Notebook metadata\n     */\n    get metadata() {\n        return this.getMetadata();\n    }\n    set metadata(v) {\n        this.setMetadata(v);\n    }\n    /**\n     * Signal triggered when a metadata changes.\n     */\n    get metadataChanged() {\n        return this._metadataChanged;\n    }\n    /**\n     * nbformat major version\n     */\n    get nbformat() {\n        return this.ymeta.get('nbformat');\n    }\n    set nbformat(value) {\n        this.transact(() => {\n            this.ymeta.set('nbformat', value);\n        }, false);\n    }\n    /**\n     * nbformat minor version\n     */\n    get nbformat_minor() {\n        return this.ymeta.get('nbformat_minor');\n    }\n    set nbformat_minor(value) {\n        this.transact(() => {\n            this.ymeta.set('nbformat_minor', value);\n        }, false);\n    }\n    /**\n     * Dispose of the resources.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        this._ycells.unobserve(this._onYCellsChanged);\n        this.ymeta.unobserveDeep(this._onMetaChanged);\n        super.dispose();\n    }\n    /**\n     * Get a shared cell by index.\n     *\n     * @param index: Cell's position.\n     *\n     * @returns The requested shared cell.\n     */\n    getCell(index) {\n        return this.cells[index];\n    }\n    /**\n     * Add a shared cell at the notebook bottom.\n     *\n     * @param cell Cell to add.\n     *\n     * @returns The added cell.\n     */\n    addCell(cell) {\n        return this.insertCell(this._ycells.length, cell);\n    }\n    /**\n     * Insert a shared cell into a specific position.\n     *\n     * @param index: Cell's position.\n     * @param cell: Cell to insert.\n     *\n     * @returns The inserted cell.\n     */\n    insertCell(index, cell) {\n        return this.insertCells(index, [cell])[0];\n    }\n    /**\n     * Insert a list of shared cells into a specific position.\n     *\n     * @param index: Position to insert the cells.\n     * @param cells: Array of shared cells to insert.\n     *\n     * @returns The inserted cells.\n     */\n    insertCells(index, cells) {\n        const yCells = cells.map(c => {\n            const cell = createCell(c, this);\n            this._ycellMapping.set(cell.ymodel, cell);\n            return cell;\n        });\n        this.transact(() => {\n            this._ycells.insert(index, yCells.map(cell => cell.ymodel));\n        });\n        return yCells;\n    }\n    /**\n     * Move a cell.\n     *\n     * @param fromIndex: Index of the cell to move.\n     * @param toIndex: New position of the cell.\n     */\n    moveCell(fromIndex, toIndex) {\n        this.moveCells(fromIndex, toIndex);\n    }\n    /**\n     * Move cells.\n     *\n     * @param fromIndex: Index of the first cells to move.\n     * @param toIndex: New position of the first cell (in the current array).\n     * @param n: Number of cells to move (default 1)\n     */\n    moveCells(fromIndex, toIndex, n = 1) {\n        // FIXME we need to use yjs move feature to preserve undo history\n        const clones = new Array(n)\n            .fill(true)\n            .map((_, idx) => this.getCell(fromIndex + idx).toJSON());\n        this.transact(() => {\n            this._ycells.delete(fromIndex, n);\n            this._ycells.insert(fromIndex > toIndex ? toIndex : toIndex - n + 1, clones.map(clone => createCell(clone, this).ymodel));\n        });\n    }\n    /**\n     * Remove a cell.\n     *\n     * @param index: Index of the cell to remove.\n     */\n    deleteCell(index) {\n        this.deleteCellRange(index, index + 1);\n    }\n    /**\n     * Remove a range of cells.\n     *\n     * @param from: The start index of the range to remove (inclusive).\n     * @param to: The end index of the range to remove (exclusive).\n     */\n    deleteCellRange(from, to) {\n        // Cells will be removed from the mapping in the model event listener.\n        this.transact(() => {\n            this._ycells.delete(from, to - from);\n        });\n    }\n    /**\n     * Delete a metadata notebook.\n     *\n     * @param key The key to delete\n     */\n    deleteMetadata(key) {\n        if (typeof this.getMetadata(key) === 'undefined') {\n            return;\n        }\n        const allMetadata = this.metadata;\n        delete allMetadata[key];\n        this.setMetadata(allMetadata);\n    }\n    getMetadata(key) {\n        const ymetadata = this.ymeta.get('metadata');\n        // Transiently the metadata can be missing - like during destruction\n        if (ymetadata === undefined) {\n            return undefined;\n        }\n        if (typeof key === 'string') {\n            const value = ymetadata.get(key);\n            return typeof value === 'undefined'\n                ? undefined // undefined is converted to `{}` by `JSONExt.deepCopy`\n                : JSONExt.deepCopy(value);\n        }\n        else {\n            return JSONExt.deepCopy(ymetadata.toJSON());\n        }\n    }\n    setMetadata(metadata, value) {\n        var _a;\n        if (typeof metadata === 'string') {\n            if (typeof value === 'undefined') {\n                throw new TypeError(`Metadata value for ${metadata} cannot be 'undefined'; use deleteMetadata.`);\n            }\n            if (JSONExt.deepEqual((_a = this.getMetadata(metadata)) !== null && _a !== void 0 ? _a : null, value)) {\n                return;\n            }\n            const update = {};\n            update[metadata] = value;\n            this.updateMetadata(update);\n        }\n        else {\n            if (!this.metadata || !JSONExt.deepEqual(this.metadata, metadata)) {\n                const clone = JSONExt.deepCopy(metadata);\n                const ymetadata = this.ymeta.get('metadata');\n                // Transiently the metadata can be missing - like during destruction\n                if (ymetadata === undefined) {\n                    return undefined;\n                }\n                this.transact(() => {\n                    ymetadata.clear();\n                    for (const [key, value] of Object.entries(clone)) {\n                        ymetadata.set(key, value);\n                    }\n                });\n            }\n        }\n    }\n    /**\n     * Updates the metadata associated with the notebook.\n     *\n     * @param value: Metadata's attribute to update.\n     */\n    updateMetadata(value) {\n        // TODO: Maybe modify only attributes instead of replacing the whole metadata?\n        const clone = JSONExt.deepCopy(value);\n        const ymetadata = this.ymeta.get('metadata');\n        // Transiently the metadata can be missing - like during destruction\n        if (ymetadata === undefined) {\n            return undefined;\n        }\n        this.transact(() => {\n            for (const [key, value] of Object.entries(clone)) {\n                ymetadata.set(key, value);\n            }\n        });\n    }\n    /**\n     * Get the notebook source\n     *\n     * @returns The notebook\n     */\n    getSource() {\n        return this.toJSON();\n    }\n    /**\n     * Set the notebook source\n     *\n     * @param value The notebook\n     */\n    setSource(value) {\n        this.fromJSON(value);\n    }\n    /**\n     * Override the notebook with a JSON-serialized document.\n     *\n     * @param value The notebook\n     */\n    fromJSON(value) {\n        this.transact(() => {\n            this.nbformat = value.nbformat;\n            this.nbformat_minor = value.nbformat_minor;\n            const metadata = value.metadata;\n            if (metadata['orig_nbformat'] !== undefined) {\n                delete metadata['orig_nbformat'];\n            }\n            if (!this.metadata) {\n                const ymetadata = new Y.Map();\n                for (const [key, value] of Object.entries(metadata)) {\n                    ymetadata.set(key, value);\n                }\n                this.ymeta.set('metadata', ymetadata);\n            }\n            else {\n                this.metadata = metadata;\n            }\n            const useId = value.nbformat === 4 && value.nbformat_minor >= 5;\n            const ycells = value.cells.map(cell => {\n                if (!useId) {\n                    delete cell.id;\n                }\n                return cell;\n            });\n            this.insertCells(this.cells.length, ycells);\n            this.deleteCellRange(0, this.cells.length);\n        });\n    }\n    /**\n     * Serialize the model to JSON.\n     */\n    toJSON() {\n        // strip cell ids if we have notebook format 4.0-4.4\n        const pruneCellId = this.nbformat === 4 && this.nbformat_minor <= 4;\n        return {\n            metadata: this.metadata,\n            nbformat_minor: this.nbformat_minor,\n            nbformat: this.nbformat,\n            cells: this.cells.map(c => {\n                const raw = c.toJSON();\n                if (pruneCellId) {\n                    delete raw.id;\n                }\n                return raw;\n            })\n        };\n    }\n}\n//# sourceMappingURL=ynotebook.js.map","/**\n * Utility module to work with Arrays.\n *\n * @module array\n */\n\nimport * as set from './set.js'\n\n/**\n * Return the last element of an array. The element must exist\n *\n * @template L\n * @param {ArrayLike<L>} arr\n * @return {L}\n */\nexport const last = arr => arr[arr.length - 1]\n\n/**\n * @template C\n * @return {Array<C>}\n */\nexport const create = () => /** @type {Array<C>} */ ([])\n\n/**\n * @template D\n * @param {Array<D>} a\n * @return {Array<D>}\n */\nexport const copy = a => /** @type {Array<D>} */ (a.slice())\n\n/**\n * Append elements from src to dest\n *\n * @template M\n * @param {Array<M>} dest\n * @param {Array<M>} src\n */\nexport const appendTo = (dest, src) => {\n  for (let i = 0; i < src.length; i++) {\n    dest.push(src[i])\n  }\n}\n\n/**\n * Transforms something array-like to an actual Array.\n *\n * @function\n * @template T\n * @param {ArrayLike<T>|Iterable<T>} arraylike\n * @return {T}\n */\nexport const from = Array.from\n\n/**\n * True iff condition holds on every element in the Array.\n *\n * @function\n * @template ITEM\n * @template {ArrayLike<ITEM>} ARR\n *\n * @param {ARR} arr\n * @param {function(ITEM, number, ARR):boolean} f\n * @return {boolean}\n */\nexport const every = (arr, f) => {\n  for (let i = 0; i < arr.length; i++) {\n    if (!f(arr[i], i, arr)) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * True iff condition holds on some element in the Array.\n *\n * @function\n * @template S\n * @template {ArrayLike<S>} ARR\n * @param {ARR} arr\n * @param {function(S, number, ARR):boolean} f\n * @return {boolean}\n */\nexport const some = (arr, f) => {\n  for (let i = 0; i < arr.length; i++) {\n    if (f(arr[i], i, arr)) {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * @template ELEM\n *\n * @param {ArrayLike<ELEM>} a\n * @param {ArrayLike<ELEM>} b\n * @return {boolean}\n */\nexport const equalFlat = (a, b) => a.length === b.length && every(a, (item, index) => item === b[index])\n\n/**\n * @template ELEM\n * @param {Array<Array<ELEM>>} arr\n * @return {Array<ELEM>}\n */\nexport const flatten = arr => arr.reduce((acc, val) => acc.concat(val), [])\n\nexport const isArray = Array.isArray\n\n/**\n * @template T\n * @param {Array<T>} arr\n * @return {Array<T>}\n */\nexport const unique = arr => from(set.from(arr))\n\n/**\n * @template T\n * @template M\n * @param {ArrayLike<T>} arr\n * @param {function(T):M} mapper\n * @return {Array<T>}\n */\nexport const uniqueBy = (arr, mapper) => {\n  /**\n   * @type {Set<M>}\n   */\n  const happened = set.create()\n  /**\n   * @type {Array<T>}\n   */\n  const result = []\n  for (let i = 0; i < arr.length; i++) {\n    const el = arr[i]\n    const mapped = mapper(el)\n    if (!happened.has(mapped)) {\n      happened.add(mapped)\n      result.push(el)\n    }\n  }\n  return result\n}\n","/**\n * Common functions and function call helpers.\n *\n * @module function\n */\n\nimport * as array from './array.js'\nimport * as object from './object.js'\n\n/**\n * Calls all functions in `fs` with args. Only throws after all functions were called.\n *\n * @param {Array<function>} fs\n * @param {Array<any>} args\n */\nexport const callAll = (fs, args, i = 0) => {\n  try {\n    for (; i < fs.length; i++) {\n      fs[i](...args)\n    }\n  } finally {\n    if (i < fs.length) {\n      callAll(fs, args, i + 1)\n    }\n  }\n}\n\nexport const nop = () => {}\n\n/**\n * @template T\n * @param {function():T} f\n * @return {T}\n */\nexport const apply = f => f()\n\n/**\n * @template A\n *\n * @param {A} a\n * @return {A}\n */\nexport const id = a => a\n\n/**\n * @template T\n *\n * @param {T} a\n * @param {T} b\n * @return {boolean}\n */\nexport const equalityStrict = (a, b) => a === b\n\n/**\n * @template T\n *\n * @param {Array<T>|object} a\n * @param {Array<T>|object} b\n * @return {boolean}\n */\nexport const equalityFlat = (a, b) => a === b || (a != null && b != null && a.constructor === b.constructor && ((a instanceof Array && array.equalFlat(a, /** @type {Array<T>} */ (b))) || (typeof a === 'object' && object.equalFlat(a, b))))\n\n/* c8 ignore start */\n\n/**\n * @param {any} a\n * @param {any} b\n * @return {boolean}\n */\nexport const equalityDeep = (a, b) => {\n  if (a == null || b == null) {\n    return equalityStrict(a, b)\n  }\n  if (a.constructor !== b.constructor) {\n    return false\n  }\n  if (a === b) {\n    return true\n  }\n  switch (a.constructor) {\n    case ArrayBuffer:\n      a = new Uint8Array(a)\n      b = new Uint8Array(b)\n    // eslint-disable-next-line no-fallthrough\n    case Uint8Array: {\n      if (a.byteLength !== b.byteLength) {\n        return false\n      }\n      for (let i = 0; i < a.length; i++) {\n        if (a[i] !== b[i]) {\n          return false\n        }\n      }\n      break\n    }\n    case Set: {\n      if (a.size !== b.size) {\n        return false\n      }\n      for (const value of a) {\n        if (!b.has(value)) {\n          return false\n        }\n      }\n      break\n    }\n    case Map: {\n      if (a.size !== b.size) {\n        return false\n      }\n      for (const key of a.keys()) {\n        if (!b.has(key) || !equalityDeep(a.get(key), b.get(key))) {\n          return false\n        }\n      }\n      break\n    }\n    case Object:\n      if (object.length(a) !== object.length(b)) {\n        return false\n      }\n      for (const key in a) {\n        if (!object.hasProperty(a, key) || !equalityDeep(a[key], b[key])) {\n          return false\n        }\n      }\n      break\n    case Array:\n      if (a.length !== b.length) {\n        return false\n      }\n      for (let i = 0; i < a.length; i++) {\n        if (!equalityDeep(a[i], b[i])) {\n          return false\n        }\n      }\n      break\n    default:\n      return false\n  }\n  return true\n}\n\n/**\n * @template V\n * @template {V} OPTS\n *\n * @param {V} value\n * @param {Array<OPTS>} options\n */\n// @ts-ignore\nexport const isOneOf = (value, options) => options.includes(value)\n/* c8 ignore stop */\n","/**\n * Utility module to work with key-value stores.\n *\n * @module map\n */\n\n/**\n * Creates a new Map instance.\n *\n * @function\n * @return {Map<any, any>}\n *\n * @function\n */\nexport const create = () => new Map()\n\n/**\n * Copy a Map object into a fresh Map object.\n *\n * @function\n * @template X,Y\n * @param {Map<X,Y>} m\n * @return {Map<X,Y>}\n */\nexport const copy = m => {\n  const r = create()\n  m.forEach((v, k) => { r.set(k, v) })\n  return r\n}\n\n/**\n * Get map property. Create T if property is undefined and set T on map.\n *\n * ```js\n * const listeners = map.setIfUndefined(events, 'eventName', set.create)\n * listeners.add(listener)\n * ```\n *\n * @function\n * @template V,K\n * @template {Map<K,V>} MAP\n * @param {MAP} map\n * @param {K} key\n * @param {function():V} createT\n * @return {V}\n */\nexport const setIfUndefined = (map, key, createT) => {\n  let set = map.get(key)\n  if (set === undefined) {\n    map.set(key, set = createT())\n  }\n  return set\n}\n\n/**\n * Creates an Array and populates it with the content of all key-value pairs using the `f(value, key)` function.\n *\n * @function\n * @template K\n * @template V\n * @template R\n * @param {Map<K,V>} m\n * @param {function(V,K):R} f\n * @return {Array<R>}\n */\nexport const map = (m, f) => {\n  const res = []\n  for (const [key, value] of m) {\n    res.push(f(value, key))\n  }\n  return res\n}\n\n/**\n * Tests whether any key-value pairs pass the test implemented by `f(value, key)`.\n *\n * @todo should rename to some - similarly to Array.some\n *\n * @function\n * @template K\n * @template V\n * @param {Map<K,V>} m\n * @param {function(V,K):boolean} f\n * @return {boolean}\n */\nexport const any = (m, f) => {\n  for (const [key, value] of m) {\n    if (f(value, key)) {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * Tests whether all key-value pairs pass the test implemented by `f(value, key)`.\n *\n * @function\n * @template K\n * @template V\n * @param {Map<K,V>} m\n * @param {function(V,K):boolean} f\n * @return {boolean}\n */\nexport const all = (m, f) => {\n  for (const [key, value] of m) {\n    if (!f(value, key)) {\n      return false\n    }\n  }\n  return true\n}\n","/**\n * Common Math expressions.\n *\n * @module math\n */\n\nexport const floor = Math.floor\nexport const ceil = Math.ceil\nexport const abs = Math.abs\nexport const imul = Math.imul\nexport const round = Math.round\nexport const log10 = Math.log10\nexport const log2 = Math.log2\nexport const log = Math.log\nexport const sqrt = Math.sqrt\n\n/**\n * @function\n * @param {number} a\n * @param {number} b\n * @return {number} The sum of a and b\n */\nexport const add = (a, b) => a + b\n\n/**\n * @function\n * @param {number} a\n * @param {number} b\n * @return {number} The smaller element of a and b\n */\nexport const min = (a, b) => a < b ? a : b\n\n/**\n * @function\n * @param {number} a\n * @param {number} b\n * @return {number} The bigger element of a and b\n */\nexport const max = (a, b) => a > b ? a : b\n\nexport const isNaN = Number.isNaN\n\nexport const pow = Math.pow\n/**\n * Base 10 exponential function. Returns the value of 10 raised to the power of pow.\n *\n * @param {number} exp\n * @return {number}\n */\nexport const exp10 = exp => Math.pow(10, exp)\n\nexport const sign = Math.sign\n\n/**\n * @param {number} n\n * @return {boolean} Wether n is negative. This function also differentiates between -0 and +0\n */\nexport const isNegativeZero = n => n !== 0 ? n < 0 : 1 / n < 0\n","/**\n * Utility functions for working with EcmaScript objects.\n *\n * @module object\n */\n\n/**\n * @return {Object<string,any>} obj\n */\nexport const create = () => Object.create(null)\n\n/**\n * Object.assign\n */\nexport const assign = Object.assign\n\n/**\n * @param {Object<string,any>} obj\n */\nexport const keys = Object.keys\n\n/**\n * @template V\n * @param {{[k:string]:V}} obj\n * @param {function(V,string):any} f\n */\nexport const forEach = (obj, f) => {\n  for (const key in obj) {\n    f(obj[key], key)\n  }\n}\n\n/**\n * @todo implement mapToArray & map\n *\n * @template R\n * @param {Object<string,any>} obj\n * @param {function(any,string):R} f\n * @return {Array<R>}\n */\nexport const map = (obj, f) => {\n  const results = []\n  for (const key in obj) {\n    results.push(f(obj[key], key))\n  }\n  return results\n}\n\n/**\n * @param {Object<string,any>} obj\n * @return {number}\n */\nexport const length = obj => keys(obj).length\n\n/**\n * @param {Object<string,any>} obj\n * @param {function(any,string):boolean} f\n * @return {boolean}\n */\nexport const some = (obj, f) => {\n  for (const key in obj) {\n    if (f(obj[key], key)) {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * @param {Object|undefined} obj\n */\nexport const isEmpty = obj => {\n  for (const _k in obj) {\n    return false\n  }\n  return true\n}\n\n/**\n * @param {Object<string,any>} obj\n * @param {function(any,string):boolean} f\n * @return {boolean}\n */\nexport const every = (obj, f) => {\n  for (const key in obj) {\n    if (!f(obj[key], key)) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * Calls `Object.prototype.hasOwnProperty`.\n *\n * @param {any} obj\n * @param {string|symbol} key\n * @return {boolean}\n */\nexport const hasProperty = (obj, key) => Object.prototype.hasOwnProperty.call(obj, key)\n\n/**\n * @param {Object<string,any>} a\n * @param {Object<string,any>} b\n * @return {boolean}\n */\nexport const equalFlat = (a, b) => a === b || (length(a) === length(b) && every(a, (val, key) => (val !== undefined || hasProperty(b, key)) && b[key] === val))\n","/**\n * Observable class prototype.\n *\n * @module observable\n */\n\nimport * as map from './map.js'\nimport * as set from './set.js'\nimport * as array from './array.js'\n\n/**\n * Handles named events.\n *\n * @template N\n */\nexport class Observable {\n  constructor () {\n    /**\n     * Some desc.\n     * @type {Map<N, any>}\n     */\n    this._observers = map.create()\n  }\n\n  /**\n   * @param {N} name\n   * @param {function} f\n   */\n  on (name, f) {\n    map.setIfUndefined(this._observers, name, set.create).add(f)\n  }\n\n  /**\n   * @param {N} name\n   * @param {function} f\n   */\n  once (name, f) {\n    /**\n     * @param  {...any} args\n     */\n    const _f = (...args) => {\n      this.off(name, _f)\n      f(...args)\n    }\n    this.on(name, _f)\n  }\n\n  /**\n   * @param {N} name\n   * @param {function} f\n   */\n  off (name, f) {\n    const observers = this._observers.get(name)\n    if (observers !== undefined) {\n      observers.delete(f)\n      if (observers.size === 0) {\n        this._observers.delete(name)\n      }\n    }\n  }\n\n  /**\n   * Emit a named event. All registered event listeners that listen to the\n   * specified name will receive the event.\n   *\n   * @todo This should catch exceptions\n   *\n   * @param {N} name The event name.\n   * @param {Array<any>} args The arguments that are applied to the event listener.\n   */\n  emit (name, args) {\n    // copy all listeners to an array first to make sure that no event is emitted to listeners that are subscribed while the event handler is called.\n    return array.from((this._observers.get(name) || map.create()).values()).forEach(f => f(...args))\n  }\n\n  destroy () {\n    this._observers = map.create()\n  }\n}\n","/**\n * Utility module to work with sets.\n *\n * @module set\n */\n\nexport const create = () => new Set()\n\n/**\n * @template T\n * @param {Set<T>} set\n * @return {Array<T>}\n */\nexport const toArray = set => Array.from(set)\n\n/**\n * @template T\n * @param {Set<T>} set\n * @return {T}\n */\nexport const first = set =>\n  set.values().next().value || undefined\n\n/**\n * @template T\n * @param {Iterable<T>} entries\n * @return {Set<T>}\n */\nexport const from = entries => new Set(entries)\n","/**\n * Utility module to work with time.\n *\n * @module time\n */\n\nimport * as metric from './metric.js'\nimport * as math from './math.js'\n\n/**\n * Return current time.\n *\n * @return {Date}\n */\nexport const getDate = () => new Date()\n\n/**\n * Return current unix time.\n *\n * @return {number}\n */\nexport const getUnixTime = Date.now\n\n/**\n * Transform time (in ms) to a human readable format. E.g. 1100 => 1.1s. 60s => 1min. .001 => 10μs.\n *\n * @param {number} d duration in milliseconds\n * @return {string} humanized approximation of time\n */\nexport const humanizeDuration = d => {\n  if (d < 60000) {\n    const p = metric.prefix(d, -1)\n    return math.round(p.n * 100) / 100 + p.prefix + 's'\n  }\n  d = math.floor(d / 1000)\n  const seconds = d % 60\n  const minutes = math.floor(d / 60) % 60\n  const hours = math.floor(d / 3600) % 24\n  const days = math.floor(d / 86400)\n  if (days > 0) {\n    return days + 'd' + ((hours > 0 || minutes > 30) ? ' ' + (minutes > 30 ? hours + 1 : hours) + 'h' : '')\n  }\n  if (hours > 0) {\n    /* c8 ignore next */\n    return hours + 'h' + ((minutes > 0 || seconds > 30) ? ' ' + (seconds > 30 ? minutes + 1 : minutes) + 'min' : '')\n  }\n  return minutes + 'min' + (seconds > 0 ? ' ' + seconds + 's' : '')\n}\n"],"names":["convertYMapEventToMapChange","event","changes","Map","keys","forEach","key","set","action","oldValue","newValue","this","ymeta","get","createMutex","token","f","outdatedTimeout","Awareness","constructor","doc","super","clientID","states","meta","_checkInterval","setInterval","now","getLocalState","lastUpdated","setLocalState","remove","clientid","has","push","length","removeAwarenessStates","math","on","destroy","emit","clearInterval","state","currLocalMeta","clock","undefined","prevState","delete","added","updated","filteredUpdated","removed","setLocalStateField","field","value","getStates","awareness","clients","origin","i","curMeta","encodeAwarenessUpdate","len","encoder","encoding","createEncoder","writeVarUint","writeVarString","JSON","stringify","toUint8Array","modifyAwarenessUpdate","update","modify","decoder","decoding","createDecoder","readVarUint","parse","readVarString","modifiedState","applyAwarenessUpdate","timestamp","time","getUnixTime","clientMeta","currClock","equalityDeep","YDocument","options","_a","onStateChanged","stateChange","Array","keysChanged","change","name","ystate","_changed","Signal","_isDisposed","_disposed","_ydoc","ydoc","_ystate","getMap","_undoManager","trackedOrigins","Set","_awareness","observe","undoManager","changed","disposed","isDisposed","JSONExt","deepCopy","toJSON","canUndo","undoStack","canRedo","redoStack","dispose","unobserve","clearData","getState","setState","deepEqual","source","getSource","setSource","undo","redo","clearUndoHistory","clear","transact","undoable","YFile","version","ysource","getText","_modelObserver","sourceChange","delta","addToScope","create","v","toString","ytext","insert","updateSource","start","end","createCellModelFromSharedType","type","YCodeCell","YMarkdownCell","YRawCell","Error","createCell","cell","notebook","_b","ymodel","ymetadata","cell_type","id","UUID","uuid4","ycell","attachments","setAttachments","youtputs","cCell","execution_count","outputs","setOutputs","metadata","setMetadata","join","createStandaloneCell","YBaseCell","prototype","events","transaction","getChanges","_metadataChanged","_notebook","_ysource","_ymetadata","_prevSourceLength","disableDocumentWideUndoRedo","getArray","observeDeep","_c","getId","isStandalone","getMetadata","metadataChanged","unobserveDeep","deleteMetadata","jupyter","outputs_hidden","others","Object","TypeError","isHidden","clone","collapsed","entries","sourceEvent","find","target","metadataEvents","metadataChange","equal","modelEvent","_youtputs","count","executionState","getOutputs","createOutputs","newOutputs","output","_newOutput1","output_type","text","outputWithoutText","newText","_text","_newOutput2","newOutput","removeStreamOutput","index","prevText","appendStreamOutput","updateOutputs","fin","streamOutputEvent","path","streamOutputChange","outputEvent","outputsChange","executionCountChange","executionStateChange","YAttachmentCell","getAttachments","attachmentsChange","YNotebook","_onMetaChanged","metaEvent","nbformatChanged","nbformat","nbformat_minor","_onYCellsChanged","item","content","_ycellMapping","c","deleted","model","cellsChange","d","insertedCells","map","cells","splice","retain","_ycells","WeakMap","_disableDocumentWideUndoRedo","toArray","_d","_e","_f","_g","_h","_j","ynotebook","data","fromJSON","getCell","addCell","insertCell","insertCells","yCells","moveCell","fromIndex","toIndex","moveCells","n","clones","fill","_","idx","deleteCell","deleteCellRange","from","to","allMetadata","updateMetadata","useId","ycells","pruneCellId","raw","last","arr","copy","a","slice","appendTo","dest","src","every","some","equalFlat","b","flatten","reduce","acc","val","concat","isArray","unique","uniqueBy","mapper","happened","result","el","mapped","add","callAll","fs","args","nop","apply","equalityStrict","equalityFlat","array","object","ArrayBuffer","Uint8Array","byteLength","size","isOneOf","includes","m","r","k","setIfUndefined","createT","res","any","all","floor","Math","ceil","abs","imul","round","log10","log2","log","sqrt","min","max","isNaN","Number","pow","exp10","exp","sign","isNegativeZero","assign","obj","results","isEmpty","_k","hasProperty","hasOwnProperty","call","Observable","_observers","once","off","observers","values","first","next","getDate","Date","humanizeDuration","p","metric","prefix","seconds","minutes","hours","days"],"sourceRoot":""}